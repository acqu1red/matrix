<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>–û–ø–ª–∞—Ç–∞ ‚Äî –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  * { box-sizing: border-box; }
  body { margin: 0; background: #121212; font-family: 'Inter', sans-serif; color: #f0eadf;
         display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
  header { background: #1f1f1f; padding: 16px 0; text-align: center; position: relative;
           border: 2px solid #d6c7b8; border-radius: 12px; margin: 12px 16px 8px 16px; flex-shrink: 0; }
  header h1 { margin: 0; font-weight: 600; font-size: 1.4rem; color: #f0eadf;
              display: inline-flex; align-items: center; gap: 8px; justify-content: center; }
  header svg { width: 30px; height: 30px; vertical-align: middle; filter: drop-shadow(0 0 8px rgba(255,255,255,.7)); }
  main { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; padding: 0 16px; }
  .step-container { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 20px 0; }
  .step { display: none; flex-direction: column; gap: 24px; animation: fadeInUp .4s ease-out; }
  .step.active { display: flex; }
  .step.active .tariff-title-block { animation: tariffTitleGlow 2s ease-in-out infinite alternate, fadeInUp .6s ease-out; }
  @keyframes fadeInUp { from{opacity:0; transform: translateY(20px);} to{opacity:1; transform: translateY(0);} }
  .content-block { background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
                   border: 2px solid #333; border-radius: 16px; padding: 24px;
                   box-shadow: 0 8px 32px rgba(0,0,0,.3); transition: all .3s ease; }
  .content-block:hover { border-color:#d6c7b8; box-shadow:0 12px 40px rgba(214,199,184,.1); }
  .tariff-title-block { background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
                        border:3px solid #d6c7b8; border-radius:20px; padding:20px; margin-bottom:20px; position:relative; overflow:hidden;
                        animation: tariffTitleGlow 2s ease-in-out infinite alternate; box-shadow:0 8px 25px rgba(214,199,184,.2); }
  .tariff-title-block::before { content:''; position:absolute; top:0; left:0; width:100%; height:100%;
                                background: linear-gradient(180deg, transparent, rgba(214,199,184,.1), transparent);
                                animation: tariffTitleShimmer 3s ease-in-out infinite; }
  .tariff-title-block::after { content:''; position:absolute; top:-50%; right:-50%; width:100px; height:100px;
                               background: radial-gradient(circle, rgba(214,199,184,.1) 0%, transparent 70%);
                               border-radius:50%; animation: tariffTitlePulse 4s ease-in-out infinite; }
  @keyframes tariffTitleGlow { 0%{ box-shadow:0 8px 25px rgba(214,199,184,.2); border-color:#d6c7b8; } 100%{ box-shadow:0 12px 35px rgba(214,199,184,.4); border-color:#f0eadf; } }
  @keyframes tariffTitleShimmer { 0%{opacity:0; transform:translateY(-20px);} 50%{opacity:1; transform:translateY(0);} 100%{opacity:0; transform:translateY(20px);} }
  @keyframes tariffTitlePulse { 0%,100%{ transform:scale(1); opacity:.3;} 50%{ transform:scale(1.2); opacity:.6;} }
  .tariff-title-text { font-size:1.3rem; font-weight:700; color:#f0eadf; text-align:left; margin:0; padding-left:16px; padding-right:80px; position:relative; z-index:2; text-shadow:0 2px 4px rgba(0,0,0,.5); animation: tariffTitleText 2s ease-in-out infinite alternate; }
  @keyframes tariffTitleText { 0%{ transform:scale(1); color:#f0eadf;} 100%{ transform:scale(1.02); color:#d6c7b8;} }
  .tariff-badge { position:absolute; top:12px; right:12px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); 
                  color:#121212; padding:6px 12px; border-radius:12px; font-size:.75rem; font-weight:700; 
                  box-shadow:0 4px 15px rgba(255,255,255,.4), 0 0 20px rgba(255,255,255,.2); transform:translateZ(0); 
                  border:2px solid rgba(255,255,255,.3); letter-spacing:0.5px; 
                  animation: badgeGlow 2s ease-in-out infinite alternate; }
  @keyframes badgeGlow { 
    0% { box-shadow:0 4px 15px rgba(255,255,255,.4), 0 0 20px rgba(255,255,255,.2); transform:scale(1); }
    100% { box-shadow:0 6px 20px rgba(255,255,255,.6), 0 0 30px rgba(255,255,255,.4); transform:scale(1.05); }
  }
  .content-text { font-size:1.1rem; line-height:1.6; color:#f0eadf; margin-bottom:20px; }
  .content-text em { color:#a6a8ad; font-style:italic; }
  .tariff-grid { display:grid; gap:16px; margin-top:20px; overflow: hidden; }
  .tariff-option { background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%); border:2px solid #444; border-radius:16px; padding:20px; cursor:pointer; transition:all .3s ease; position:relative; overflow:hidden; }
  .tariff-option::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background: linear-gradient(90deg, transparent, rgba(214,199,184,.1), transparent); transition:left .6s ease; }
  .tariff-option:hover::before { left:100%; }
  .tariff-option:hover { border-color:#d6c7b8; transform:translateY(-4px); box-shadow:0 12px 30px rgba(214,199,184,.2); }
  .tariff-option.featured:hover { transform:scale(1.01) translateY(-3px); }
  
  /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è 6-–º–µ—Å—è—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ */
  .tariff-option.featured { 
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
    border: 3px solid #d6c7b8;
    box-shadow: 0 6px 20px rgba(214,199,184,.25), 0 0 20px rgba(214,199,184,.08);
    animation: featuredGlow 3s ease-in-out infinite alternate;
    transform: scale(1.005);
  }
  @keyframes featuredGlow {
    0% { 
      box-shadow: 0 6px 20px rgba(214,199,184,.25), 0 0 20px rgba(214,199,184,.08);
      border-color: #d6c7b8;
    }
    100% { 
      box-shadow: 0 8px 25px rgba(214,199,184,.35), 0 0 25px rgba(214,199,184,.12);
      border-color: #f0eadf;
    }
  }
  .tariff-option.featured::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 20% 30%, rgba(214,199,184,0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(214,199,184,0.1) 0%, transparent 50%),
      radial-gradient(circle at 40% 80%, rgba(214,199,184,0.12) 0%, transparent 50%);
    border-radius: 16px;
    z-index: -1;
    animation: neuralGlow 4s ease-in-out infinite alternate;
  }
  
  /* Canvas –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ª–∏–Ω–∏–π */
  .tariff-option.featured .animated-lines {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 16px;
    z-index: -1;
    pointer-events: none;
    overflow: hidden;
  }
  
  .tariff-option.featured .animated-lines canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  

  

  
  .tariff-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
  .tariff-name { font-size:1.2rem; font-weight:600; color:#f0eadf; }
  
  /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤ 6-–º–µ—Å—è—á–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ */
  .tariff-option.featured .tariff-name {
    background: rgba(0,0,0,0.6);
    padding: 4px 8px;
    border-radius: 6px;
    backdrop-filter: blur(4px);
    font-size: 1.56rem; /* –£–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 30% (1.2 * 1.3) */
    margin-top: 8px; /* –°–¥–≤–∏–≥–∞–µ–º –Ω–∏–∂–µ */
    margin-left: 8px; /* –°–¥–≤–∏–≥–∞–µ–º –≤–ª–µ–≤–æ */
    align-self: flex-start; /* –ü—Ä–∏–∂–∏–º–∞–µ–º –∫ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
  }
  
  .tariff-option.featured .price-container {
    margin-top: 60px; /* –°–¥–≤–∏–≥–∞–µ–º —Ü–µ–Ω—ã –µ—â–µ –Ω–∏–∂–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É –±–µ–π–¥–∂–µ–º –∏ —ç–∫–æ–Ω–æ–º–∏–µ–π */
    background: rgba(0,0,0,0.6);
    padding: 6px 10px;
    border-radius: 6px;
    backdrop-filter: blur(4px);
    align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
    justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    position: relative;
    right: 0;
  }
  
  .tariff-option.featured .price-container .original-price {
    font-size: 0.945rem; /* –£–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 5% (0.9 * 1.05) */
  }
  
  .tariff-option.featured .price-container .current-price {
    font-size: 1.155rem; /* –£–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 5% (1.1 * 1.05) */
  }
  
  .tariff-option.featured .price-container .monthly-price {
    font-size: 0.893rem; /* –£–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 5% (0.85 * 1.05) */
  }
  
  .tariff-option.featured .tariff-description {
    background: rgba(0,0,0,0.6);
    padding: 4px 8px;
    border-radius: 6px;
    backdrop-filter: blur(4px);
    display: inline-block;
    margin-top: 8px;
  }
  
  .tariff-option.featured .savings-info {
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
    border: 1px solid rgba(76,175,80,.3);
  }
  .tariff-price { background: linear-gradient(135deg, #d6c7b8 0%, #f0eadf 100%); color:#121212; padding:8px 16px; border-radius:20px; font-weight:700; font-size:1rem; box-shadow:0 4px 15px rgba(214,199,184,.3); }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã—Ö —Ü–µ–Ω */
  .price-container { 
    display: flex; 
    flex-direction: column; 
    align-items: flex-end; 
    gap: 4px; 
  }
  .original-price { 
    text-decoration: line-through; 
    color: #a6a8ad; 
    font-size: 0.9rem; 
    font-weight: 400;
    opacity: 0.7;
  }
  .current-price { 
    color: #f0eadf; 
    font-weight: 700; 
    font-size: 1.1rem;
  }
  .monthly-price { 
    color: #d6c7b8; 
    font-size: 0.85rem; 
    font-weight: 600;
    margin-top: 2px;
  }
  
  .tariff-description { color:#a6a8ad; font-size:.9rem; line-height:1.4; }
  
  /* –ë–µ–π–¥–∂ "–õ—É—á—à–∞—è —Ü–µ–Ω–∞" */
  .best-price-badge {
    position: absolute;
    top: 4px;
    right: 8px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    box-shadow: 0 4px 15px rgba(255,107,107,.4);
    animation: bestPricePulse 2s ease-in-out infinite alternate;
    z-index: 10;
  }
  @keyframes bestPricePulse {
    0% { 
      box-shadow: 0 4px 15px rgba(255,107,107,.4);
      transform: scale(1);
    }
    100% { 
      box-shadow: 0 6px 20px rgba(255,107,107,.6);
      transform: scale(1.1);
    }
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ */
  .savings-info {
    background: linear-gradient(135deg, rgba(76,175,80,.1) 0%, rgba(76,175,80,.05) 100%);
    border: 1px solid rgba(76,175,80,.3);
    border-radius: 8px;
    padding: 8px 12px;
    margin-top: 8px;
    font-size: 0.85rem;
    color: #4CAF50;
    font-weight: 600;
    animation: savingsGlow 2s ease-in-out infinite alternate;
  }
  @keyframes savingsGlow {
    0% { 
      box-shadow: 0 0 5px rgba(76,175,80,.2);
      border-color: rgba(76,175,80,.3);
    }
    100% { 
      box-shadow: 0 0 15px rgba(76,175,80,.4);
      border-color: rgba(76,175,80,.5);
    }
  }
  
  .payment-methods { display:grid; gap:16px; margin-top:20px; }
  .payment-method { background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%); border:2px solid #444; border-radius:16px; padding:20px; cursor:pointer; transition:all .3s ease; display:flex; align-items:center; gap:16px; }
  .payment-method:hover { border-color:#d6c7b8; transform:translateY(-2px); box-shadow:0 8px 25px rgba(214,199,184,.2); }
  .payment-icon { width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem; flex-shrink:0; position:relative; overflow:hidden; }
  .payment-icon.russian { background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); color:#121212; box-shadow:0 4px 15px rgba(255,255,255,.4), 0 0 20px rgba(255,255,255,.2); animation: iconGlow 2s ease-in-out infinite alternate; }
  .payment-icon.international { background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); color:#121212; box-shadow:0 4px 15px rgba(255,255,255,.4), 0 0 20px rgba(255,255,255,.2); animation: iconGlow 2s ease-in-out infinite alternate; }
  @keyframes iconGlow { 
    0% { box-shadow:0 4px 15px rgba(255,255,255,.4), 0 0 20px rgba(255,255,255,.2); transform:scale(1); }
    100% { box-shadow:0 6px 20px rgba(255,255,255,.6), 0 0 30px rgba(255,255,255,.4); transform:scale(1.05); }
  }
  .payment-icon::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,.1) 50%, transparent 70%); transform:translateX(-100%); transition:transform 0.6s ease; }
  .payment-method:hover .payment-icon::before { transform:translateX(100%); }
  .payment-info { flex-grow:1; }
  .payment-name { font-size:1.1rem; font-weight:600; color:#f0eadf; margin-bottom:4px; }
  .payment-description { color:#a6a8ad; font-size:.9rem; }
  .form-group { margin-bottom:20px; }
  .form-label { display:block; font-size:1rem; font-weight:600; color:#f0eadf; margin-bottom:8px; }
  .form-input { width:100%; padding:16px; background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%); border:2px solid #444; border-radius:12px; color:#f0eadf; font-size:1rem; transition:all .3s ease; outline:none; }
  .form-input:focus { border-color:#d6c7b8; box-shadow:0 0 0 3px rgba(214,199,184,.1); }
  .form-input::placeholder { color:#a6a8ad; }
  .payment-method-display { display:flex; align-items:center; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border:2px solid #3498db; border-radius:12px; padding:16px; margin:8px 0; position:relative; overflow:hidden; transition:all .3s ease; animation: paymentGlow 2s ease-in-out infinite alternate; }
  .payment-title { font-weight:600; color:#ecf0f1; font-size:16px; margin-bottom:4px; }
  .payment-subtitle { color:#bdc3c7; font-size:14px; font-style:italic; }
  @keyframes paymentGlow { 0%{ box-shadow:0 0 5px rgba(52,152,219,.3);} 100%{ box-shadow:0 0 20px rgba(52,152,219,.6);} }
  .button-group { display:grid; gap:12px; margin-top:24px; }
  .btn { padding:16px 24px; border:none; border-radius:12px; font-size:1rem; font-weight:600; cursor:pointer; transition:all .3s ease; text-align:center; display:flex; align-items:center; justify-content:center; gap:8px; }
  .btn-primary { background: linear-gradient(135deg, #d6c7b8 0%, #f0eadf 100%); color:#121212; box-shadow:0 4px 15px rgba(214,199,184,.3); }
  .btn-secondary { background: linear-gradient(135deg, #3a3a3a 0%, #2a2a2a 100%); color:#f0eadf; border:2px solid #444; }
  .progress-bar { display:flex; justify-content:center; gap:12px; margin-bottom:24px; align-items:center; }
  .progress-step { width:16px; height:16px; border-radius:50%; background:#444; transition:all .3s ease; position:relative; }
  .progress-step.active { background:linear-gradient(135deg, #d6c7b8 0%, #f0eadf 100%); transform:scale(1.3); box-shadow:0 0 20px rgba(214,199,184,.6); }
  .progress-step.completed { background:linear-gradient(135deg, #4CAF50 0%, #45a049 100%); transform:scale(1.1); box-shadow:0 0 15px rgba(76,175,80,.5); }
  .progress-step::after { content:''; position:absolute; top:50%; left:50%; width:8px; height:8px; background:#ffffff; border-radius:50%; transform:translate(-50%, -50%) scale(0); transition:transform 0.3s ease; }
  .progress-step.completed::after { transform:translate(-50%, -50%) scale(1); }
  .progress-step.active::after { transform:translate(-50%, -50%) scale(1); background:#121212; }
  .progress-label { font-size:0.8rem; color:#a6a8ad; margin-top:4px; text-align:center; font-weight:500; }
  @media (max-width:480px){ .content-block{padding:20px;} .tariff-option{padding:16px;} .payment-method{padding:16px;} .btn{padding:14px 20px;} }
  .step-container::-webkit-scrollbar { width:6px; }
  .step-container::-webkit-scrollbar-track { background:#1f1f1f; }
  .step-container::-webkit-scrollbar-thumb { background:#d6c7b8; border-radius:3px; }
  .error { color:#ff7b7b; font-size:.95rem; }
  .summary-item { display:flex; justify-content:space-between; align-items:center; border-bottom:1px dashed #333; padding:12px 0; min-height:24px; }
  .summary-label { color:#a6a8ad; font-weight:500; min-width:140px; }
  .summary-value { color:#f0eadf; font-weight:600; text-align:right; flex-grow:1; }
</style>
</head>
<body>
<header>
  <h1>üí≥ –û–ø–ª–∞—Ç–∞ –¥–æ—Å—Ç—É–ø–∞
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
      <line x1="1" y1="10" x2="23" y2="10"/>
    </svg>
  </h1>
</header>

<main>
  <div class="step-container">
    <div class="step active" id="step1">
      <div class="progress-bar">
        <div class="progress-step active"></div>
        <div class="progress-step"></div>
        <div class="progress-step"></div>
        <div class="progress-step"></div>
      </div>
      <div class="content-block">
        <div class="content-text">–¢—ã —Å–¥–µ–ª–∞–ª –≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä.</div>
        <div class="content-text">–í—ã–±–µ—Ä–∏ —Ç–∞—Ä–∏—Ñ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –§–æ—Ä–º—É–ª—É:</div>
      </div>
      <div class="tariff-grid">
        <div class="tariff-option" data-tariff="1_month" data-price="790" data-periodicity="MONTHLY">
          <div class="tariff-header">
            <div class="tariff-name">1 –º–µ—Å—è—Ü</div>
            <div class="price-container">
              <div class="current-price">790 ‚ÇΩ</div>
              <div class="monthly-price">–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
            </div>
          </div>
          <div class="tariff-description">–ë–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–∞–Ω–∞–ª—É</div>
        </div>
        
        <div class="tariff-option featured" data-tariff="6_months" data-price="3990" data-periodicity="PERIOD_180_DAYS">
          <div class="animated-lines">
            <canvas id="neuralCanvas"></canvas>
          </div>
          <div class="best-price-badge">–õ—É—á—à–∞—è —Ü–µ–Ω–∞</div>
          <div class="tariff-header">
            <div class="tariff-name">6 –º–µ—Å—è—Ü–µ–≤</div>
            <div class="price-container">
              <div class="original-price">4 800 ‚ÇΩ</div>
              <div class="current-price">3 990 ‚ÇΩ</div>
              <div class="monthly-price">667 ‚ÇΩ/–º–µ—Å</div>
            </div>
          </div>
          <div class="tariff-description">1 –º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
          <div class="savings-info">–≠–∫–æ–Ω–æ–º–∏—è 810 ‚ÇΩ (‚âà 16,9%)</div>
        </div>
        
        <div class="tariff-option" data-tariff="12_months" data-price="7790" data-periodicity="PERIOD_YEAR">
          <div class="tariff-header">
            <div class="tariff-name">12 –º–µ—Å—è—Ü–µ–≤</div>
            <div class="price-container">
              <div class="original-price">9 600 ‚ÇΩ</div>
              <div class="current-price">7 790 ‚ÇΩ</div>
              <div class="monthly-price">649 ‚ÇΩ/–º–µ—Å</div>
            </div>
          </div>
          <div class="tariff-description">2 –º–µ—Å—è—Ü–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
          <div class="savings-info">–≠–∫–æ–Ω–æ–º–∏—è 1 810 ‚ÇΩ (‚âà 18,8%)</div>
        </div>
      </div>
      <div class="content-block">
        <div class="content-text"><em>*—Ü–µ–Ω–∞ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö/–µ–≤—Ä–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –Ω—ã–Ω–µ—à–Ω–µ–º—É –∫—É—Ä—Å—É</em><br><em>*–æ–ø–ª–∞—á–∏–≤–∞–π –ª—é–±–æ–π –∫–∞—Ä—Ç–æ–π –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö/–µ–≤—Ä–æ/—Ä—É–±–ª—è—Ö, –±–æ—Ç —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å–∞–º</em></div>
      </div>
    </div>

    <div class="step" id="step2">
      <div class="progress-bar">
        <div class="progress-step completed"></div>
        <div class="progress-step active"></div>
        <div class="progress-step"></div>
        <div class="progress-step"></div>
      </div>
      <div class="tariff-title-block"><div class="tariff-badge">–í–´–ë–†–ê–ù</div><div class="tariff-title-text" id="selectedTariffTitle">–§–û–†–ú–£–õ–ê / 1 –º–µ—Å—è—Ü</div></div>
      <div class="content-block">
        <div class="content-text"><em>*–µ—Å–ª–∏ –≤—ã –∏–∑ –£–∫—Ä–∞–∏–Ω—ã, –≤–∫–ª—é—á–∏—Ç–µ VPN</em><br><em>*–ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –∫–∞—Ä—Ç–æ–π ‚Äî –æ—Ñ–æ—Ä–º–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π</em><br><em>*–¥–∞–ª–µ–µ ‚Äî –≤—ã —Å–º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–ø–∏—Å–∫–æ–π –≤ –ú–µ–Ω—é</em></div>
        <div class="content-text">–¢–µ–ø–µ—Ä—å —Ç–µ–±–µ –æ—Å—Ç–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–±–∞–Ω–∫):</div>
      </div>
      <div class="payment-methods">
        <div class="payment-method" data-method="card" data-bank="russian">
          <div class="payment-icon russian">üá∑üá∫</div><div class="payment-info"><div class="payment-name">–ë–∞–Ω–∫ –†–§ (RUB)</div><div class="payment-description">–õ—é–±–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –†–§</div></div>
        </div>
        <div class="payment-method" data-method="card" data-bank="international">
          <div class="payment-icon international">üåç</div><div class="payment-info"><div class="payment-name">–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –±–∞–Ω–∫ (EUR)</div><div class="payment-description">–õ—é–±–∞—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞</div></div>
        </div>
      </div>
      <div class="button-group"><button class="btn btn-secondary" onclick="goToStep(1)">–ù–∞–∑–∞–¥</button></div>
    </div>

    <div class="step" id="step3">
      <div class="progress-bar">
        <div class="progress-step completed"></div>
        <div class="progress-step completed"></div>
        <div class="progress-step active"></div>
        <div class="progress-step"></div>
      </div>
      <div class="tariff-title-block"><div class="tariff-badge">–¢–û–í–ê–†</div><div class="tariff-title-text" id="productTitle">–§–û–†–ú–£–õ–ê / 1 –º–µ—Å.</div></div>
      <div class="content-block">
        <div class="content-text"><strong>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</strong><br><span id="productNameText">–§–û–†–ú–£–õ–ê / 1 –º–µ—Å.</span></div>
        <div class="form-group">
          <label class="form-label">–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã</label>
          <div class="payment-method-display"><div class="payment-icon">üí≥</div><div class="payment-info"><div class="payment-title" id="bankTitle">–ë–∞–Ω–∫ –†–§</div><div class="payment-subtitle" id="bankSubtitle">–õ—é–±–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</div></div></div>
        </div>
        <div class="form-group">
          <label class="form-label">–í–∞—à E-mail: <span style="color:#ff6b6b;">*</span></label>
          <input type="email" class="form-input" id="userEmail" placeholder="example@email.com" required>
          <div id="emailError" class="error" style="display:none;">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</div>
        </div>
        <div class="content-text"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å</strong><br><span id="finalPrice">790 RUB</span></div>
      </div>
      <div class="button-group"><button class="btn btn-primary" id="toConfirmBtn">–î–∞–ª–µ–µ</button><button class="btn btn-secondary" onclick="goToStep(2)">–ù–∞–∑–∞–¥</button></div>
    </div>

    <div class="step" id="step4">
      <div class="progress-bar">
        <div class="progress-step completed"></div>
        <div class="progress-step completed"></div>
        <div class="progress-step completed"></div>
        <div class="progress-step active"></div>
      </div>
      <div class="content-block" id="summaryBlock">
        <div class="content-text">–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã:</div>
        <div class="summary-item"><span class="summary-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</span><span class="summary-value" id="confirmProductName">–§–û–†–ú–£–õ–ê / 1 –º–µ—Å.</span></div>
        <div class="summary-item"><span class="summary-label">–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã</span><span class="summary-value" id="confirmPaymentMethod">–ë–∞–Ω–∫ –†–§</span></div>
        <div class="summary-item"><span class="summary-label">–í–∞—à E-mail</span><span class="summary-value" id="confirmEmail">example@email.com</span></div>
        <div class="summary-item"><span class="summary-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</span><span class="summary-value" id="confirmPrice">790 RUB</span></div>
        <div id="apiError" class="error" style="margin-top:8px;"></div>
      </div>
      <div class="button-group" id="payBtnGroup"><button class="btn btn-primary" id="payBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button><button class="btn btn-secondary" onclick="goToStep(3)">–ù–∞–∑–∞–¥</button></div>
    </div>
  </div>
</main>

<script src="neural-lines.js"></script>
<script>
const tg = window.Telegram ? window.Telegram.WebApp : null;
if (tg) { tg.ready(); tg.expand(); }

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π
let neuralAnimation = null;
function initNeuralAnimation() {
  const canvas = document.getElementById('neuralCanvas');
  if (canvas && window.NeuralLinesAnimation) {
    neuralAnimation = new NeuralLinesAnimation(canvas);
  }
}

const state = { 
  currentStep: 1, 
  selectedTariff: null, 
  selectedPaymentMethod: 'card', 
  selectedBank: null, 
  userEmail: '',
  selectedPeriodicity: null,
  prices: {
    '1_month': 790,
    '6_months': 3990,
    '12_months': 7790
  }, 
  tariffNames: {
    '1_month': '1 –º–µ—Å—è—Ü',
    '6_months': '6 –º–µ—Å—è—Ü–µ–≤',
    '12_months': '12 –º–µ—Å—è—Ü–µ–≤'
  },
  periodicities: {
    '1_month': 'MONTHLY',
    '6_months': 'PERIOD_180_DAYS',
    '12_months': 'PERIOD_YEAR'
  }
};

document.addEventListener('DOMContentLoaded', initUI);
function initUI(){
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π
  initNeuralAnimation();
  document.querySelectorAll('.tariff-option').forEach(opt=>{
    opt.addEventListener('click', ()=>{
      state.selectedTariff = opt.dataset.tariff;
      const price = Number(opt.dataset.price||0);
      const periodicity = opt.dataset.periodicity;
      
      document.querySelectorAll('.tariff-option').forEach(o=>o.style.borderColor='#444');
      opt.style.borderColor='#d6c7b8';
      
      const tName = state.tariffNames[state.selectedTariff] || '';
      state.selectedPeriodicity = periodicity;
      
      document.getElementById('selectedTariffTitle').textContent = `–§–æ—Ä–º—É–ª–∞ –Ω–∞ ${tName}`;
      document.getElementById('productTitle').textContent = `–§–û–†–ú–£–õ–ê / ${tName}`;
      document.getElementById('productNameText').textContent = `–§–û–†–ú–£–õ–ê / ${tName}`;
      document.getElementById('finalPrice').textContent = `${price} RUB`;
      document.getElementById('confirmProductName').textContent = `–§–û–†–ú–£–õ–ê / ${tName}`;
      document.getElementById('confirmPrice').textContent = `${price} RUB`;
      goToStep(2);
    });
  });
  document.querySelectorAll('.payment-method').forEach(m=>{
    m.addEventListener('click', ()=>{
      const bank = m.dataset.bank;
      state.selectedPaymentMethod='card'; state.selectedBank=bank;
      document.querySelectorAll('.payment-method').forEach(x=>x.style.borderColor='#444');
      m.style.borderColor='#d6c7b8';
      const isRu = bank==='russian';
      document.getElementById('bankTitle').textContent = isRu ? '–ë–∞–Ω–∫ –†–§' : '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –±–∞–Ω–∫';
      document.getElementById('bankSubtitle').textContent = isRu ? '–õ—é–±–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞' : '–û–ø–ª–∞—Ç–∞ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ–π';
      document.getElementById('confirmPaymentMethod').textContent = isRu ? '–ë–∞–Ω–∫ –†–§' : '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –±–∞–Ω–∫';
      goToStep(3);
    });
  });
  const emailEl = document.getElementById('userEmail');
  const emailError = document.getElementById('emailError');
  emailEl.addEventListener('input', ()=>{
    state.userEmail = emailEl.value.trim();
    document.getElementById('confirmEmail').textContent = state.userEmail || '–ù–µ —É–∫–∞–∑–∞–Ω';
    emailError.style.display='none';
  });
  document.getElementById('toConfirmBtn').addEventListener('click', ()=>{
    if(!validateEmail(state.userEmail)){ emailError.style.display='block'; return; }
    goToStep(4);
  });
  document.getElementById('payBtn').addEventListener('click', createAndOpenInvoice);
}
function validateEmail(email){ return !!email && email.includes('@') && email.indexOf('.') > email.indexOf('@'); }
function goToStep(step){ document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); document.getElementById(`step${step}`).classList.add('active'); updateProgress(step); state.currentStep=step; }
function updateProgress(step){ const dots=document.querySelectorAll('.progress-step'); dots.forEach((d,i)=>{d.classList.remove('active','completed'); if(i+1<step) d.classList.add('completed'); else if(i+1===step) d.classList.add('active');}); }

async function createAndOpenInvoice(){
  const apiBase = "https://formulaprivate-production.up.railway.app";
  const btn = document.getElementById('payBtn');
  const apiError = document.getElementById('apiError'); apiError.textContent='';

  if(!state.selectedPaymentMethod) state.selectedPaymentMethod='card';
  if(!state.selectedBank) state.selectedBank='russian';
  if(!state.selectedTariff){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ'); goToStep(1); return; }
  if(!validateEmail(state.userEmail)){ alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'); goToStep(3); return; }

  const tariffCode = 'basic';
  const telegram_id = (tg && tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.id) ? tg.initDataUnsafe.user.id : null;
  const username = (tg && tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.username) ? tg.initDataUnsafe.user.username : null;
  const init_data = tg ? tg.initData : null;

  const payload = { 
    email: state.userEmail, 
    tariff: tariffCode, 
    bank: state.selectedBank, 
    telegram_id, 
    username, 
    init_data,
    periodicity: state.selectedPeriodicity
  };

  try{
    btn.disabled = true; btn.textContent = "–°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞...";
    const r = await fetch(apiBase + "/api/pay/create", { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) });
    const resp = await r.json();
    if(!resp.ok) throw new Error(resp.error || "–û—à–∏–±–∫–∞ API");
    if(!resp.payment_url) throw new Error("–ù–µ –ø–æ–ª—É—á–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É");
    window.location.href = resp.payment_url;
  }catch(e){
    console.error(e); apiError.textContent = "‚ùå " + e.message; btn.disabled=false; btn.textContent="–û–ø–ª–∞—Ç–∏—Ç—å";
  }
}
</script>
</body>
</html>