<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–Ø–∑—ã–∫ —Ç–µ–ª–∞ ‚Äî –ö–≤–µ—Å—Ç‚Äë–•–∞–±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../quests.css" />
  <style>
    .bodylang-quest {
      position: relative;
      min-height: 100vh;
      background: linear-gradient(135deg, #0B1020 0%, #1A2332 100%);
      overflow: hidden;
    }
    
    .video-container {
      position: relative;
      width: 100%;
      height: 300px;
      border-radius: var(--radius);
      overflow: hidden;
      margin: 20px 0;
      background: var(--bg1);
      border: 2px solid var(--border);
    }
    
    .video-player {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: var(--bg0);
    }
    
    .video-controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .play-btn {
      background: var(--glow1);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
    }
    
    .play-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(102, 247, 213, 0.5);
    }
    
    .progress-bar {
      flex: 1;
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--glow1);
      width: 0%;
      transition: width 0.3s ease;
    }
    
    .face-container {
      position: relative;
      width: 100%;
      height: 400px;
      border-radius: var(--radius);
      overflow: hidden;
      margin: 20px 0;
      background: var(--bg1);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .face {
      position: relative;
      width: 200px;
      height: 200px;
      background: linear-gradient(180deg, #F7FAFC 0%, #E2E8F0 100%);
      border-radius: 50%;
      border: 3px solid #CBD5E0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transition: all 0.5s ease;
    }
    
    .face-eyes {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 30px;
      display: flex;
      justify-content: space-between;
    }
    
    .face-eye {
      width: 25px;
      height: 25px;
      background: #2D3748;
      border-radius: 50%;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .face-eye::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }
    
    .face-brows {
      position: absolute;
      top: 45px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 20px;
      display: flex;
      justify-content: space-between;
    }
    
    .face-brow {
      width: 30px;
      height: 8px;
      background: #4A5568;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    
    .face-mouth {
      position: absolute;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 30px;
      background: #E53E3E;
      border-radius: 0 0 60px 60px;
      transition: all 0.3s ease;
    }
    
    .face-nose {
      position: absolute;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 30px;
      background: #CBD5E0;
      border-radius: 10px;
    }
    
    /* Face expressions */
    .face.happy .face-mouth {
      width: 50px;
      height: 25px;
      border-radius: 0 0 50px 50px;
    }
    
    .face.happy .face-brow {
      transform: translateY(-2px);
    }
    
    .face.sad .face-mouth {
      width: 40px;
      height: 15px;
      border-radius: 50px 50px 0 0;
      transform: translateX(-50%) translateY(5px);
    }
    
    .face.sad .face-brow {
      transform: translateY(2px) rotate(-5deg);
    }
    
    .face.angry .face-brow {
      transform: translateY(-3px) rotate(-15deg);
    }
    
    .face.angry .face-mouth {
      width: 45px;
      height: 20px;
      border-radius: 0 0 45px 45px;
    }
    
    .face.surprised .face-eye {
      width: 30px;
      height: 30px;
    }
    
    .face.surprised .face-mouth {
      width: 35px;
      height: 35px;
      border-radius: 50%;
    }
    
    .face.fear .face-eye {
      width: 20px;
      height: 30px;
    }
    
    .face.fear .face-brow {
      transform: translateY(3px);
    }
    
    .face.disgust .face-mouth {
      width: 30px;
      height: 15px;
      border-radius: 0 0 30px 30px;
    }
    
    .face.contempt .face-brow {
      transform: translateY(-2px);
    }
    
    .face.contempt .face-mouth {
      width: 40px;
      height: 8px;
      border-radius: 0 0 40px 40px;
    }
    
    .face.confused .face-brow {
      transform: translateY(-1px) rotate(5deg);
    }
    
    .face.confused .face-eye {
      width: 22px;
      height: 22px;
    }
    
    .face.determined .face-brow {
      transform: translateY(-3px);
    }
    
    .face.determined .face-mouth {
      width: 45px;
      height: 12px;
      border-radius: 0 0 45px 45px;
    }
    
    .face.anxious .face-eye {
      width: 18px;
      height: 25px;
    }
    
    .face.anxious .face-brow {
      transform: translateY(1px);
    }
    
    .face.anxious .face-mouth {
      width: 35px;
      height: 10px;
      border-radius: 0 0 35px 35px;
    }
    
    .face.excited .face-eye {
      width: 28px;
      height: 28px;
    }
    
    .face.excited .face-mouth {
      width: 55px;
      height: 30px;
      border-radius: 0 0 55px 55px;
    }
    
    .face.thoughtful .face-brow {
      transform: translateY(-2px) rotate(-3deg);
    }
    
    .face.thoughtful .face-mouth {
      width: 30px;
      height: 8px;
      border-radius: 0 0 30px 30px;
    }
    
    .face.skeptical .face-brow {
      transform: translateY(-1px) rotate(10deg);
    }
    
    .face.skeptical .face-mouth {
      width: 25px;
      height: 6px;
      border-radius: 0 0 25px 25px;
    }
    
    .face.relieved .face-eye {
      width: 20px;
      height: 20px;
    }
    
    .face.relieved .face-mouth {
      width: 40px;
      height: 20px;
      border-radius: 0 0 40px 40px;
    }
    
    .face.frustrated .face-brow {
      transform: translateY(-2px) rotate(-8deg);
    }
    
    .face.frustrated .face-mouth {
      width: 35px;
      height: 15px;
      border-radius: 0 0 35px 35px;
    }
    
    .face.curious .face-eye {
      width: 26px;
      height: 26px;
    }
    
    .face.curious .face-brow {
      transform: translateY(-1px);
    }
    
    .face.curious .face-mouth {
      width: 30px;
      height: 12px;
      border-radius: 0 0 30px 30px;
    }
    
    .analysis-options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    
    .analysis-option {
      background: var(--glass-strong);
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .analysis-option:hover {
      border-color: var(--glow1);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 247, 213, 0.1);
    }
    
    .analysis-option.correct {
      border-color: var(--success);
      background: rgba(74, 222, 128, 0.1);
    }
    
    .analysis-option.incorrect {
      border-color: var(--error);
      background: rgba(248, 113, 113, 0.1);
    }
    
    .option-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--glass);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .option-content {
      flex: 1;
    }
    
    .option-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text);
    }
    
    .option-description {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.4;
    }
    
    .quest-phase {
      display: none;
    }
    
    .quest-phase.active {
      display: block;
    }
    
    .phase-indicator {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 20px 0;
    }
    
    .phase-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--border);
      transition: all 0.3s ease;
    }
    
    .phase-dot.active {
      background: var(--glow1);
      transform: scale(1.2);
    }
    
    .phase-dot.completed {
      background: var(--success);
    }
    
    .quest-complete {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--glass-strong);
      border: 2px solid var(--glow1);
      border-radius: var(--radius);
      padding: 30px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s ease;
      z-index: 20;
      backdrop-filter: blur(20px);
      max-width: 400px;
      width: 90%;
    }
    
    .quest-complete.show {
      opacity: 1;
      pointer-events: all;
    }
    
    .complete-icon {
      font-size: 48px;
      margin-bottom: 15px;
      animation: completeBounce 1s infinite;
    }
    
    @keyframes completeBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .attempts-counter {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
      padding: 10px;
      background: var(--glass);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }
    
    .attempts-text {
      font-size: 14px;
      color: var(--text-muted);
    }
    
    .attempts-dots {
      display: flex;
      gap: 4px;
    }
    
    .attempt-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border);
      transition: all 0.3s ease;
    }
    
    .attempt-dot.used {
      background: var(--error);
    }
    
    .attempt-dot.available {
      background: var(--success);
    }
  </style>
</head>
<body>
  <div class="bodylang-quest">
    <div class="app">
      <header class="glass topbar">
        <div class="brand">
          <button id="btnBack" class="btn ghost">‚Üê</button>
          <h1>–Ø–∑—ã–∫ —Ç–µ–ª–∞</h1>
          <div class="badge">–§–∞–∑–∞ <span id="currentPhase">1</span>/2</div>
        </div>
        <div class="actions">
          <button id="btnHelp" class="btn ghost">‚ùì</button>
        </div>
      </header>

      <main class="content">
        <div class="phase-indicator">
          <div class="phase-dot active" data-phase="1"></div>
          <div class="phase-dot" data-phase="2"></div>
        </div>

        <!-- –§–∞–∑–∞ 1: –í–∏–¥–µ–æ –¥–æ–ø—Ä–æ—Å -->
        <div id="phase1" class="quest-phase active">
          <div class="clue-container">
            <h3>üé• –ê–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ –¥–æ–ø—Ä–æ—Å–∞</h3>
            <div class="clue-text">
              –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–±–ª—é–¥–∞–π –∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º–æ–≥–æ –≤–æ –≤—Ä–µ–º—è –¥–æ–ø—Ä–æ—Å–∞. 
              –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∂–µ—Å—Ç—ã, –º–∏–º–∏–∫—É –∏ –¥–≤–∏–∂–µ–Ω–∏—è —Ç–µ–ª–∞.
            </div>
            
            <div class="video-container">
              <video id="videoPlayer" class="video-player" preload="metadata">
                <source id="videoSource" src="" type="video/mp4">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
              </video>
              <div class="video-controls">
                <button class="play-btn" id="playBtn">‚ñ∂Ô∏è</button>
                <div class="progress-bar">
                  <div class="progress-fill" id="videoProgress"></div>
                </div>
              </div>
            </div>
            
            <div class="attempts-counter">
              <span class="attempts-text">–ü–æ–ø—ã—Ç–∫–∏:</span>
              <div class="attempts-dots" id="attemptsDots">
                <div class="attempt-dot available"></div>
                <div class="attempt-dot available"></div>
                <div class="attempt-dot available"></div>
              </div>
            </div>
            
            <div class="analysis-panel">
              <h4>–ß—Ç–æ —Ç—ã –∑–∞–º–µ—Ç–∏–ª –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º–æ–≥–æ?</h4>
              <div class="analysis-options" id="phase1Options">
                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>
            </div>
          </div>
        </div>

        <!-- –§–∞–∑–∞ 2: –ê–Ω–∞–ª–∏–∑ –ª–∏—Ü–∞ -->
        <div id="phase2" class="quest-phase">
          <div class="clue-container">
            <h3>üòê –ê–Ω–∞–ª–∏–∑ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ª–∏—Ü–∞</h3>
            <div class="clue-text">
              –¢–µ–ø–µ—Ä—å –∏–∑—É—á–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞ —á–µ–ª–æ–≤–µ–∫–∞. –ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –æ–Ω –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç?
              –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≥–ª–∞–∑–∞, –±—Ä–æ–≤–∏, —Ä–æ—Ç –∏ –æ–±—â–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.
            </div>
            
            <div class="face-container">
              <div class="face" id="face">
                <div class="face-brows">
                  <div class="face-brow"></div>
                  <div class="face-brow"></div>
                </div>
                <div class="face-eyes">
                  <div class="face-eye"></div>
                  <div class="face-eye"></div>
                </div>
                <div class="face-nose"></div>
                <div class="face-mouth"></div>
              </div>
            </div>
            
            <div class="attempts-counter">
              <span class="attempts-text">–ü–æ–ø—ã—Ç–∫–∏:</span>
              <div class="attempts-dots" id="attemptsDots2">
                <div class="attempt-dot available"></div>
                <div class="attempt-dot available"></div>
                <div class="attempt-dot available"></div>
              </div>
            </div>
            
            <div class="analysis-panel">
              <h4>–ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫?</h4>
              <div class="analysis-options" id="phase2Options">
                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>
            </div>
          </div>
        </div>

        <div class="quest-complete" id="questComplete">
          <div class="complete-icon">üéâ</div>
          <h3>–ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h3>
          <p>–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —è–∑—ã–∫ —Ç–µ–ª–∞.</p>
          <div style="background: var(--glass); border-radius: var(--radius-sm); padding: 16px; margin: 16px 0;">
            <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 8px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: 700; color: var(--glow1);">+2</div>
                <div style="font-size: 12px; color: var(--text-muted);">–§—Ä–∞–≥–º–µ–Ω—Ç–∞</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 20px; font-weight: 700; color: var(--glow2);">+60</div>
                <div style="font-size: 12px; color: var(--text-muted);">–û–ø—ã—Ç–∞</div>
              </div>
            </div>
          </div>
          <p style="font-size: 14px; color: var(--text-muted); margin-top: 16px;">
            –í –∑–∞–∫—Ä—ã—Ç–æ–º –∫–∞–Ω–∞–ª–µ —Ç—ã –º–æ–∂–µ—à—å —É–∑–Ω–∞—Ç—å –æ —è–∑—ã–∫–µ —Ç–µ–ª–∞ –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ - 
            –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ –∑–∞–º–µ—á–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –ù–∞—É—á–∏—à—å—Å—è –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å 
            —è–∑—ã–∫ —Ç–µ–ª–∞ —Ç–∞–∫, —á—Ç–æ –∑–∞ —Å–µ–∫—É–Ω–¥—É –Ω–∞—á–Ω–µ—à—å –ø–æ–Ω–∏–º–∞—Ç—å.
          </p>
          <div class="questActions">
            <button id="completeBtn" class="btn primary">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–∞
    const QUEST_CONFIG = {
      maxAttempts: 3,
      rewards: { fragments: 2, experience: 60 }
    };

    // –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –¥–æ–ø—Ä–æ—Å–æ–≤
    const VIDEO_DATA = {
      dopros1: { correct: "–°–µ–ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (—É—Ö–æ–¥) –æ—Ç –≤–æ–ø—Ä–æ—Å–∞" },
      dopros2: { correct: "–õ–µ–≥–∫–æ–µ –Ω–∞—Ö–º—É—Ä–∏–≤–∞–Ω–∏–µ" },
      dopros3: { correct: "–ü–æ–¥–∂–∞—Ç–∏–µ –≥—É–±" },
      dopros4: { correct: "–£—á–∞—â–µ–Ω–Ω–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ" },
      dopros5: { correct: "–ü–æ–¥–∂–∞—Ç–∏–µ –≥—É–±" },
      dopros6: { correct: "–°–µ–ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (—É—Ö–æ–¥) –æ—Ç –≤–æ–ø—Ä–æ—Å–∞" },
      dopros7: { correct: "–õ–µ–≥–∫–æ–µ –Ω–∞—Ö–º—É—Ä–∏–≤–∞–Ω–∏–µ" },
      dopros8: { correct: "–ü–æ–¥–∂–∞—Ç–∏–µ –≥—É–±" }
    };

    // –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤–∏–¥–µ–æ
    const VIDEO_OPTIONS = [
      "–ü–æ–¥–∂–∞—Ç–∏–µ –≥—É–±",
      "–£—á–∞—â–µ–Ω–Ω–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ", 
      "–õ–µ–≥–∫–æ–µ –Ω–∞—Ö–º—É—Ä–∏–≤–∞–Ω–∏–µ",
      "–õ–µ–≥–∫–æ–µ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–µ –ª–∏—Ü–∞ (–ø–æ–¥–±–æ—Ä–æ–¥–∫–∞, –Ω–æ—Å–∞, –≤–∏—Å–∫–∞)",
      "–ü–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ–ª–æ–≤—ã –≤ —Å—Ç–æ—Ä–æ–Ω—É",
      "–°–µ–ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (—É—Ö–æ–¥) –æ—Ç –≤–æ–ø—Ä–æ—Å–∞",
      "–û—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –≥–æ–ª–æ–≤—ã –Ω–∞–∑–∞–¥",
      "–î–≤–∏–∂–µ–Ω–∏–µ —Å—É—Å—Ç–∞–≤–∞–º–∏ (–¥–µ—Ä–≥–∞–Ω–∏–µ –Ω–æ–≥–æ–π –∏–ª–∏ –∫–∏—Å—Ç—å—é)",
      "–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ä—É–∫–∞–º–∏, –≤–µ—â–∞–º–∏ (–∫—Ä—É—Ç–∏—Ç —Ä—É—á–∫—É, —Ç—Ä–æ–≥–∞–µ—Ç –ø–∞–ª—å—Ü—ã –∏ —Ç–¥)",
      "–í—Å–∫–∏–¥—ã–≤–∞–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞ –≤–≤–µ—Ä—Ö",
      "–ë—ã—Å—Ç—Ä–æ–µ –æ–±–ª–∏–∑—ã–≤–∞–Ω–∏–µ –≥—É–±",
      "–°–≥–ª–∞—Ç—ã–≤–∞–Ω–∏–µ",
      "–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ —á–µ–ª—é—Å—Ç–∏"
    ];

    // –î–∞–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –ª–∏—Ü–∞
    const FACE_DATA = {
      happy: { correct: "–†–∞–¥–æ—Å—Ç—å" },
      sad: { correct: "–ì—Ä—É—Å—Ç—å" },
      angry: { correct: "–ì–Ω–µ–≤" },
      surprised: { correct: "–£–¥–∏–≤–ª–µ–Ω–∏–µ" },
      fear: { correct: "–°—Ç—Ä–∞—Ö" },
      disgust: { correct: "–û—Ç–≤—Ä–∞—â–µ–Ω–∏–µ" },
      contempt: { correct: "–ü—Ä–µ–∑—Ä–µ–Ω–∏–µ" },
      confused: { correct: "–†–∞—Å—Ç–µ—Ä—è–Ω–Ω–æ—Å—Ç—å" },
      determined: { correct: "–†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å" },
      anxious: { correct: "–¢—Ä–µ–≤–æ–≥–∞" },
      excited: { correct: "–í–æ–∑–±—É–∂–¥–µ–Ω–∏–µ" },
      thoughtful: { correct: "–ó–∞–¥—É–º—á–∏–≤–æ—Å—Ç—å" },
      skeptical: { correct: "–°–∫–µ–ø—Ç–∏—Ü–∏–∑–º" },
      relieved: { correct: "–û–±–ª–µ–≥—á–µ–Ω–∏–µ" },
      frustrated: { correct: "–†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ" },
      curious: { correct: "–õ—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ" }
    };

    // –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ª–∏—Ü–∞
    const FACE_OPTIONS = [
      "–†–∞–¥–æ—Å—Ç—å", "–ì—Ä—É—Å—Ç—å", "–ì–Ω–µ–≤", "–£–¥–∏–≤–ª–µ–Ω–∏–µ", "–°—Ç—Ä–∞—Ö", 
      "–û—Ç–≤—Ä–∞—â–µ–Ω–∏–µ", "–ü—Ä–µ–∑—Ä–µ–Ω–∏–µ", "–†–∞—Å—Ç–µ—Ä—è–Ω–Ω–æ—Å—Ç—å", "–†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", 
      "–¢—Ä–µ–≤–æ–≥–∞", "–í–æ–∑–±—É–∂–¥–µ–Ω–∏–µ", "–ó–∞–¥—É–º—á–∏–≤–æ—Å—Ç—å", "–°–∫–µ–ø—Ç–∏—Ü–∏–∑–º", 
      "–û–±–ª–µ–≥—á–µ–Ω–∏–µ", "–†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ", "–õ—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ"
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
      currentPhase: 1,
      currentVideo: null,
      currentFace: null,
      attempts: 0,
      maxAttempts: 3,
      videoAttempts: 0,
      faceAttempts: 0
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const videoPlayer = document.getElementById('videoPlayer');
    const videoSource = document.getElementById('videoSource');
    const playBtn = document.getElementById('playBtn');
    const videoProgress = document.getElementById('videoProgress');
    const face = document.getElementById('face');
    const btnBack = document.getElementById('btnBack');
    const btnHelp = document.getElementById('btnHelp');
    const completeBtn = document.getElementById('completeBtn');
    const questComplete = document.getElementById('questComplete');

    // –£—Ç–∏–ª–∏—Ç—ã
    const toast = (msg, type = 'info') => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = `toast ${type}`;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      setupEventListeners();
      loadPhase(1);
    }

    function setupEventListeners() {
      btnBack.addEventListener('click', () => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = '../quests.html';
        }
      });
      btnHelp.addEventListener('click', showHelp);
      completeBtn.addEventListener('click', completeQuest);
      playBtn.addEventListener('click', toggleVideo);
      videoPlayer.addEventListener('timeupdate', updateVideoProgress);
      videoPlayer.addEventListener('ended', onVideoEnded);
    }

    function loadPhase(phase) {
      gameState.currentPhase = phase;
      
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∞–∑—ã
      document.querySelectorAll('.quest-phase').forEach(p => p.classList.remove('active'));
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–∞–∑—É
      document.getElementById(`phase${phase}`).classList.add('active');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ñ–∞–∑
      updatePhaseIndicator(phase);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–∑—ã
      if (phase === 1) {
        loadVideoPhase();
      } else if (phase === 2) {
        loadFacePhase();
      }
    }

    function updatePhaseIndicator(phase) {
      document.querySelectorAll('.phase-dot').forEach((dot, index) => {
        dot.classList.remove('active', 'completed');
        if (index + 1 < phase) {
          dot.classList.add('completed');
        } else if (index + 1 === phase) {
          dot.classList.add('active');
        }
      });
      
      document.getElementById('currentPhase').textContent = phase;
    }

    function loadVideoPhase() {
      // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≤–∏–¥–µ–æ
      const videoKeys = Object.keys(VIDEO_DATA);
      const randomVideo = videoKeys[Math.floor(Math.random() * videoKeys.length)];
      gameState.currentVideo = randomVideo;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ
      videoSource.src = `../video/${randomVideo}.mp4`;
      videoPlayer.load();
      
      // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
      const correctAnswer = VIDEO_DATA[randomVideo].correct;
      const options = [correctAnswer];
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
      const availableOptions = VIDEO_OPTIONS.filter(opt => opt !== correctAnswer);
      for (let i = 0; i < 4; i++) {
        const randomIndex = Math.floor(Math.random() * availableOptions.length);
        options.push(availableOptions[randomIndex]);
        availableOptions.splice(randomIndex, 1);
      }
      
      // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
      options.sort(() => Math.random() - 0.5);
      
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
      const container = document.getElementById('phase1Options');
      container.innerHTML = '';
      
      options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, handleVideoAnswer);
        container.appendChild(optionEl);
      });
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏
      gameState.videoAttempts = 0;
      updateAttemptsDisplay('attemptsDots', 0);
    }

    function loadFacePhase() {
      // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞
      const faceKeys = Object.keys(FACE_DATA);
      const randomFace = faceKeys[Math.floor(Math.random() * faceKeys.length)];
      gameState.currentFace = randomFace;
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞
      face.className = `face ${randomFace}`;
      
      // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
      const correctAnswer = FACE_DATA[randomFace].correct;
      const options = [correctAnswer];
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
      const availableOptions = FACE_OPTIONS.filter(opt => opt !== correctAnswer);
      for (let i = 0; i < 2; i++) {
        const randomIndex = Math.floor(Math.random() * availableOptions.length);
        options.push(availableOptions[randomIndex]);
        availableOptions.splice(randomIndex, 1);
      }
      
      // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
      options.sort(() => Math.random() - 0.5);
      
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
      const container = document.getElementById('phase2Options');
      container.innerHTML = '';
      
      options.forEach((option, index) => {
        const optionEl = createOptionElement(option, index, handleFaceAnswer);
        container.appendChild(optionEl);
      });
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏
      gameState.faceAttempts = 0;
      updateAttemptsDisplay('attemptsDots2', 0);
    }

    function createOptionElement(option, index, handler) {
      const optionEl = document.createElement('div');
      optionEl.className = 'analysis-option';
      optionEl.innerHTML = `
        <div class="option-icon">üîç</div>
        <div class="option-content">
          <div class="option-title">${option}</div>
          <div class="option-description">–í—ã–±–µ—Ä–∏ —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>
      `;
      optionEl.addEventListener('click', () => handler(index, option));
      return optionEl;
    }

    function handleVideoAnswer(index, selectedAnswer) {
      const options = document.querySelectorAll('#phase1Options .analysis-option');
      const correctAnswer = VIDEO_DATA[gameState.currentVideo].correct;
      const isCorrect = selectedAnswer === correctAnswer;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(isCorrect ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      if (isCorrect) {
        toast('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∞–Ω–∞–ª–∏–∑—É –ª–∏—Ü–∞.', 'success');
        setTimeout(() => loadPhase(2), 1500);
      } else {
        gameState.videoAttempts++;
        updateAttemptsDisplay('attemptsDots', gameState.videoAttempts);
        
        if (gameState.videoAttempts >= gameState.maxAttempts) {
          toast('–ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!', 'error');
          setTimeout(() => {
            loadVideoPhase(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ
          }, 2000);
        } else {
          toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
          setTimeout(() => {
            options.forEach(opt => {
              opt.classList.remove('correct', 'incorrect');
              opt.style.pointerEvents = 'auto';
            });
          }, 2000);
        }
      }
    }

    function handleFaceAnswer(index, selectedAnswer) {
      const options = document.querySelectorAll('#phase2Options .analysis-option');
      const correctAnswer = FACE_DATA[gameState.currentFace].correct;
      const isCorrect = selectedAnswer === correctAnswer;
      
      options.forEach((opt, i) => {
        if (i === index) {
          opt.classList.add(isCorrect ? 'correct' : 'incorrect');
        }
        opt.style.pointerEvents = 'none';
      });
      
      if (isCorrect) {
        toast('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
        setTimeout(() => {
          questComplete.classList.add('show');
        }, 1500);
      } else {
        gameState.faceAttempts++;
        updateAttemptsDisplay('attemptsDots2', gameState.faceAttempts);
        
        if (gameState.faceAttempts >= gameState.maxAttempts) {
          toast('–ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!', 'error');
          setTimeout(() => {
            loadFacePhase(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ–µ –ª–∏—Ü–æ
          }, 2000);
        } else {
          toast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', 'error');
          setTimeout(() => {
            options.forEach(opt => {
              opt.classList.remove('correct', 'incorrect');
              opt.style.pointerEvents = 'auto';
            });
          }, 2000);
        }
      }
    }

    function updateAttemptsDisplay(containerId, usedAttempts) {
      const container = document.getElementById(containerId);
      const dots = container.querySelectorAll('.attempt-dot');
      
      dots.forEach((dot, index) => {
        dot.className = 'attempt-dot';
        if (index < usedAttempts) {
          dot.classList.add('used');
        } else {
          dot.classList.add('available');
        }
      });
    }

    function toggleVideo() {
      if (videoPlayer.paused) {
        videoPlayer.play();
        playBtn.textContent = '‚è∏Ô∏è';
      } else {
        videoPlayer.pause();
        playBtn.textContent = '‚ñ∂Ô∏è';
      }
    }

    function updateVideoProgress() {
      const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
      videoProgress.style.width = `${progress}%`;
    }

    function onVideoEnded() {
      playBtn.textContent = '‚ñ∂Ô∏è';
      videoPlayer.currentTime = 0;
    }

    function showHelp() {
      toast('–ù–∞–±–ª—é–¥–∞–π –∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –≤ –≤–∏–¥–µ–æ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –ª–∏—Ü–∞!', 'info');
    }

    function completeQuest() {
      toast('–ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ö–∞–±...', 'success');
      setTimeout(() => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = '../quests.html';
        }
      }, 1500);
    }

    // –ó–∞–ø—É—Å–∫
    init();
  </script>
</body>
</html>
