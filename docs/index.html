<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>Поддержка — Формула</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="support.css?v=1.0">
</head>
<body>
<header>
  <h1>Чат поддержки</h1>
</header>

<main id="mainContent">
  <!-- Обычный чат -->
  <div class="chat" id="chat"></div>
  
  <!-- Админ-панель -->
  <div class="admin-panel" id="adminPanel">
    <div class="admin-header">
      <div class="admin-title">Панель администратора</div>
      <button class="back-btn" id="backToChat">← Назад</button>
    </div>
    <div class="admin-stats" id="adminStats">
      <div class="stats-grid">
        <div class="stat-item clickable" id="filterAll" data-filter="all">
          <div class="stat-number" id="totalConversations">0</div>
          <div class="stat-label">Всего</div>
        </div>
        <div class="stat-item clickable active" id="filterPending" data-filter="pending">
          <div class="stat-number" id="openConversations">0</div>
          <div class="stat-label">Ожидают</div>
        </div>
        <div class="stat-item clickable" id="filterMessages" data-filter="messages">
          <div class="stat-number" id="totalMessages">0</div>
          <div class="stat-label">Сообщений</div>
        </div>
      </div>
    </div>
    <div class="conversations-list" id="conversationsList">
      <div class="loading">
        <div class="spinner"></div>
      </div>
    </div>
  </div>

  <!-- Диалог с пользователем -->
  <div class="conversation-dialog" id="conversationDialog">
    <div class="dialog-header">
       <div class="dialog-user-info">
         <div class="dialog-username" id="dialogUsername">Пользователь</div>
         <div class="dialog-meta" id="dialogMeta">Сообщений: 0</div>
       </div>
       <button class="back-btn" id="backToAdmin">← К списку</button>
     </div>
     <div class="chat" id="dialogChat"></div>
     <footer class="message-footer">
       <div class="input-container">
         <input type="text" id="dialogMessageInput" placeholder="Ответить пользователю..." autocomplete="off" />
         <div class="button-group">
           <button id="dialogSendBtn" class="action-btn send-btn" title="Отправить сообщение" aria-label="Отправить сообщение">
             <svg viewBox="0 0 24 24" fill="currentColor">
               <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
             </svg>
           </button>
         </div>
       </div>
     </footer>
   </div>
</main>

<!-- Обычный footer для пользователей -->
<footer id="userFooter" class="message-footer">
  <div class="input-container">
    <input type="file" id="fileInput" />
    <input type="text" id="messageInput" placeholder="Напишите сообщение..." autocomplete="off" />
    <div class="button-group">
      <button id="attachBtn" class="action-btn attach-btn" title="Прикрепить файл" aria-label="Прикрепить файл">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
        </svg>
      </button>
      <button id="sendBtn" class="action-btn send-btn" title="Отправить сообщение" aria-label="Отправить сообщение">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
        </svg>
      </button>
    </div>
  </div>
</footer>

<!-- Админ footer для кнопки панели администратора -->
<div class="admin-footer" id="adminFooter">
  <button class="admin-panel-btn hidden" id="adminPanelBtn">
    Панель администратора
  </button>
</div>

<script type="module" src="script.js?v=2.1"></script>
</body>
</html>